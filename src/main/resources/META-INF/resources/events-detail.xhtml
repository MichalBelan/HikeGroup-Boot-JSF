<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">>


<ui:composition template="/layout.xhtml">

    <ui:define name="title">Event Detail - #{eventBean.event.name}</ui:define>

    <ui:define name="content">
        <h:outputStylesheet library="css" name="events-detail.css"/>

        <div class="hiking-header">
            <div class="container">
                <div class="text-center">
                    <h1 class="fw-bolder">#{eventBean.event.name}</h1>
                    <p class="lead mt-3">Join us for an amazing hiking adventure</p>
                </div>
            </div>
        </div>

        <div class="container container-hiking py-5">
            <div class="row">
                <div class="col-lg-8">
                    <div class="hiking-card card mb-4">
                        <h:graphicImage styleClass="card-img-top" value="#{eventBean.event.photoUrl}" alt="Event Photo"/>
                        <div class="card-body event-detail-section">
                            <div class="event-info-box">
                                <div class="event-info-item">
                                    <strong>Start Time:</strong> #{eventBean.formatDateTime(eventBean.event.startTime)}
                                </div>
                                <div class="event-info-item">
                                    <strong>End Time:</strong> #{eventBean.formatDateTime(eventBean.event.endTime)}
                                </div>
                                <div class="event-info-item">
                                    <strong>Organized by:</strong> #{eventBean.event.club.title}
                                </div>
                            </div>

                            <h2 class="card-title mb-4">About this hiking event</h2>
                            <p class="card-text text-hiking mb-3">
                                #{eventBean.event.type}
                            </p>

                            <div class="event-type-badge">
                                #{eventBean.event.type}
                            </div>

                            <!-- Owner buttons -->
                            <h:panelGroup rendered="#{eventBean.isOwner(eventBean.event)}">
                                <div class="mt-4">
                                    <button type="button" class="btn btn-danger-hiking me-3" data-bs-toggle="modal" data-bs-target="#deleteEventModal">
                                        Delete
                                    </button>
                                    <h:form styleClass="d-inline">
                                        <h:commandButton styleClass="btn btn-hiking"
                                                       action="#{eventBean.goToEditEvent(eventBean.event.id)}"
                                                       value="Edit Event"/>
                                    </h:form>
                                </div>
                            </h:panelGroup>
                        </div>
                    </div>

                    <!-- Elevation Chart -->
                    <h:panelGroup rendered="#{eventBean.hasElevationData()}">
                        <div class="elevation-chart">
                            <h4 class="mb-3">Elevation Profile</h4>
                            <div class="chart-container">
                                <div class="chart-bars">
                                    <ui:repeat value="#{eventBean.elevationList}" var="elevation" varStatus="status">
                                        <div class="chart-bar"
                                             style="height: #{eventBean.getElevationPercentage(elevation)}%;"
                                             data-value="#{elevation}">
                                        </div>
                                    </ui:repeat>
                                </div>
                                <div class="chart-labels">
                                    <ui:repeat value="#{eventBean.elevationList}" var="elevation" varStatus="status">
                                        <span>#{status.index + 1} km</span>
                                    </ui:repeat>
                                </div>
                            </div>
                            <div class="text-center mt-2">
                                <small class="text-muted">
                                    Max elevation: #{eventBean.maxElevation}m
                                </small>
                            </div>
                        </div>
                    </h:panelGroup>
                </div>

                <div class="col-lg-4">
                    <div class="sidebar-card card mb-4">
                        <div class="card-header">
                            Search
                        </div>
                        <div class="card-body">
                            <h:form>
                                <div class="input-group">
                                    <h:inputText styleClass="form-control" pt:placeholder="Enter search term..." />
                                    <button class="btn search-btn" type="submit">Go!</button>
                                </div>
                            </h:form>
                        </div>
                    </div>

                    <div class="sidebar-card card mb-4">
                        <div class="card-header">
                            Categories
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-sm-12">
                                    <ul class="list-unstyled mb-0">
                                        <li><a href="#" class="text-decoration-none">Climbing</a></li>
                                        <li><a href="#" class="text-decoration-none">Trail</a></li>
                                        <li><a href="#" class="text-decoration-none">Hiking</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="sidebar-card card mb-4">
                        <div class="card-header">
                            Side Widget
                        </div>
                        <div class="card-body text-hiking">
                            You can put anything you want inside of these side widgets. They are easy to use, and feature the Bootstrap 5 card component!
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Event Modal -->
        <div class="modal fade" id="deleteEventModal">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Deletion</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="text-center">
                            <h5 class="mb-3 text-hiking">Are you sure you want to delete this hiking event?</h5>
                            <div class="event-info-box-modal p-3 mb-3">
                                <div class="d-flex align-items-center justify-content-center">
                                    <strong>#{eventBean.event.name}</strong>
                                </div>
                            </div>
                            <div class="warning-message">
                                <p class="text-muted mb-2">
                                    This action cannot be undone. This will permanently delete the event.
                                </p>
                                <p class="text-muted mb-3">
                                    All associated data will be lost.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button type="button" class="btn btn-secondary me-3" data-bs-dismiss="modal">
                            Cancel
                        </button>
                        <h:form>
                            <h:commandButton styleClass="btn btn-danger-hiking"
                                           action="#{eventBean.deleteEvent}"
                                           onclick="$('#deleteEventModal').modal('hide');"
                                           value="Yes, Delete">
                                <f:ajax execute="@none"/>
                            </h:commandButton>
                        </h:form>
                    </div>
                </div>
            </div>
        </div>

    </ui:define>
</ui:composition>
</html>